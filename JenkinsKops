pipeline {
    agent any
    stages {
        stage('Build KOPS Cluster on AWS') {
            steps {
                 echo 'Hello Kops'
                 env.WORKSPACE = pwd()
                 chmod -x "${env.WORKSPACE}/kops/kops.sh"

            }
        }

        stage('Input') {
            steps {
                input('Do you want to proceed to build Terraform?')
            }
        }

        stage('If Proceed is clicked') {
            steps {
                print('Terraform')
 
                // Permission to execute
                // sh "chmod +x -R ${env.WORKSPACE}/../${env.JOB_NAME}@script"
                // Call SH
                // sh "${env.WORKSPACE}/../${env.JOB_NAME}@script/script.sh"

                env.WORKSPACE = pwd()
                cd "${env.WORKSPACE}/kops/azuka_helm_terraform/"

                sed -i 's/0-0-0-0--0/aws-0-0-0-0--0/g' kubernetes.tf
                terraform upgrade:.012
                terraform init
                terraform apply -auto-approve
                cd ..
		cd ..
               
            }
        }

        stage('Some Testing') {
          steps {
            parallel(
              "Step 1": {
                 echo 'Step 1'
              },
              "Step 2": {
                 echo 'Step 2'
              }
            )
          }
        }

    }
    post {
        always {
            echo 'This will always run'
        }
        success {
            echo 'This will run only if successful'
        }
        failure {
            echo 'This will run only if failed'
        }
        unstable {
            echo 'This will run only if the run was marked as unstable'
        }
        changed {
            echo 'This will run only if the state of the Pipeline has changed'
            echo 'For example, if the Pipeline was previously failing but is now successful'
        }
    }
}
